#!/usr/bin/python

"""
@file make_plots.py
@brief selected plots from thesis
@author Andrea Klein     <alklein@alumni.stanford.edu>
"""

__author__ = "Andrea Klein"

import numpy as np

from pylab import *


def assignment_speed():

    divs = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]
    bin_counts = [d**3 for d in divs]
    old_times = [110.89, 132.85, 152.01, 159.99, 187.38999999999987, 210.2099999999998, 220.54999999999995, 236.57999999999993, 261.17999999999984, 255.8800000000001]
    new_times = [80.80000000000001, 81.45999999999998, 96.79999999999995, 99.38999999999999, 93.24000000000001, 93.7800000000002, 104.55000000000018, 101.92000000000007, 103.92000000000007, 109.15000000000009]

    figure(0)
    plot(bin_counts, old_times)
    plot(bin_counts, new_times)
    xlabel('Number of Bins', fontsize=20)
    ylabel('Time to Assign Particles (s)', fontsize=20)

def bin_densities(f1, f2):

    old_bin_count_dict_exact = {str([2, 1, 0]) : 3027763,
                            str([2, 2, 0]) : 5941279,
                            str([0, 3, 2]) : 2993393,
                            str([3, 3, 3]) : 2064237,
                            str([1, 0, 3]) : 1528957,
                            str([3, 1, 0]) : 1487485,
                            str([2, 0, 0]) : 92700348,
                            str([1, 0, 2]) : 2759301,
                            str([2, 2, 1]) : 8078392,
                            str([1, 2, 1]) : 3983160,
                            str([0, 3, 1]) : 1610651,
                            str([0, 2, 0]) : 2140187,
                            str([2, 3, 3]) : 3982111,
                            str([2, 0, 1]) : 2965732,
                            str([1, 3, 2]) : 4145405,
                            str([3, 3, 0]) : 1394611,
                            str([3, 1, 1]) : 2186649,
                            str([0, 1, 1]) : 1383116,
                            str([2, 1, 2]) : 7770413,
                            str([2, 3, 1]) : 4143565,
                            str([3, 1, 2]) : 4069450,
                            str([3, 0, 3]) : 1545052,
                            str([3, 3, 1]) : 1878563,
                            str([1, 1, 3]) : 2228818,
                            str([2, 2, 2]) : 16493547,
                            str([0, 0, 0]) : 494345296,
                            str([2, 2, 3]) : 8577862,
                            str([2, 1, 1]) : 4046395,
                            str([2, 3, 0]) : 2716505,
                            str([0, 3, 3]) : 1563246,
                            str([3, 3, 2]) : 4225244,
                            str([3, 0, 2]) : 2852346,
                            str([3, 1, 3]) : 2209197,
                            str([0, 0, 1]) : 46426344,
                            str([1, 3, 1]) : 2029195,
                            str([3, 2, 1]) : 4062491,
                            str([1, 2, 3]) : 4074878,
                            str([3, 0, 1]) : 1554721,
                            str([1, 1, 1]) : 2257458,
                            str([0, 2, 3]) : 2956746,
                            str([3, 2, 0]) : 2800314,
                            str([3, 0, 0]) : 46956489,
                            str([1, 2, 2]) : 8070967,
                            str([0, 0, 2]) : 93422679,
                            str([0, 0, 3]) : 47061511,
                            str([2, 1, 3]) : 4062898,
                            str([1, 1, 2]) : 4068504,
                            str([3, 2, 3]) : 4060096,
                            str([1, 3, 3]) : 1941133,
                            str([1, 0, 1]) : 1327937,
                            str([0, 3, 0]) : 1026501,
                            str([1, 2, 0]) : 2909343,
                            str([0, 1, 2]) : 3098050,
                            str([2, 3, 2]) : 8357948,
                            str([2, 0, 2]) : 5751314,
                            str([0, 2, 1]) : 2930007,
                            str([0, 1, 0]) : 951974,
                            str([3, 2, 2]) : 8367257,
                            str([1, 0, 0]) : 46156531,
                            str([1, 3, 0]) : 1544465,
                            str([0, 1, 3]) : 1473550,
                            str([2, 0, 3]) : 2873836,
                            str([1, 1, 0]) : 1385172,
                            str([0, 2, 2]) : 6001415
                                }

    bin_count_dict_exact = {str([2, 1, 0]) : 1442629,
                            str([2, 2, 0]) : 1626005,
                            str([4, 3, 0]) : 1299936,
                            str([0, 3, 2]) : 1534388,
                            str([4, 2, 1]) : 1938073,
                            str([3, 0, 4]) : 1425940,
                            str([2, 4, 0]) : 1594103,
                            str([0, 4, 3]) : 1594102,
                            str([3, 3, 3]) : 2064237,
                            str([1, 0, 3]) : 1528957,
                            str([3, 4, 2]) : 2071990,
                            str([3, 1, 0]) : 1487485,
                            str([2, 0, 0]) : 46503192,
                            str([4, 4, 4]) : 2150841,
                            str([4, 2, 0]) : 1295517,
                            str([1, 0, 2]) : 1305995,
                            str([2, 2, 1]) : 2160335,
                            str([4, 1, 0]) : 1585134,
                            str([1, 2, 1]) : 2105302,
                            str([0, 4, 0]) : 1089772,
                            str([3, 2, 4]) : 2178541,
                            str([0, 3, 1]) : 1610651,
                            str([2, 4, 1]) : 2020551,
                            str([3, 3, 4]) : 2163895,
                            str([0, 2, 0]) : 1050415,
                            str([2, 3, 3]) : 2031561,
                            str([2, 0, 1]) : 1362899,
                            str([1, 3, 2]) : 1985168,
                            str([3, 3, 0]) : 1394611,
                            str([3, 1, 1]) : 2186649,
                            str([0, 1, 1]) : 1383116,
                            str([4, 1, 4]) : 1908447,
                            str([2, 1, 2]) : 2017629,
                            str([1, 4, 1]) : 1877858,
                            str([2, 3, 1]) : 1937985,
                            str([0, 3, 4]) : 1459005,
                            str([4, 4, 1]) : 1959433,
                            str([3, 1, 2]) : 2043680,
                            str([4, 3, 1]) : 2205580,
                            str([4, 3, 2]) : 1967717,
                            str([3, 4, 0]) : 1418782,
                            str([3, 0, 3]) : 1545052,
                            str([3, 3, 1]) : 1878563,
                            str([0, 4, 4]) : 1375285,
                            str([1, 1, 3]) : 2228818,
                            str([2, 2, 2]) : 2037981,
                            str([0, 0, 0]) : 495087120,
                            str([4, 2, 3]) : 2119084,
                            str([1, 4, 0]) : 1582494,
                            str([2, 2, 3]) : 2046490,
                            str([2, 1, 1]) : 1889552,
                            str([4, 0, 1]) : 1602833,
                            str([2, 3, 0]) : 1416569,
                            str([0, 4, 2]) : 1536376,
                            str([0, 3, 3]) : 1563246,
                            str([1, 1, 4]) : 2062661,
                            str([1, 2, 4]) : 2126020,
                            str([3, 3, 2]) : 2061349,
                            str([3, 0, 2]) : 1426406,
                            str([3, 1, 3]) : 2209197,
                            str([1, 0, 4]) : 1453306,
                            str([1, 3, 4]) : 2160237,
                            str([0, 0, 1]) : 46426344,
                            str([3, 4, 3]) : 2003358,
                            str([4, 3, 3]) : 1950550,
                            str([1, 3, 1]) : 2029195,
                            str([4, 1, 1]) : 2156843,
                            str([2, 4, 4]) : 2022900,
                            str([4, 4, 3]) : 2147517,
                            str([3, 2, 1]) : 2070196,
                            str([2, 0, 4]) : 1445266,
                            str([2, 3, 4]) : 2113267,
                            str([1, 2, 3]) : 2065161,
                            str([3, 0, 1]) : 1554721,
                            str([2, 1, 4]) : 1817243,
                            str([1, 4, 3]) : 2009717,
                            str([1, 1, 1]) : 2257458,
                            str([2, 2, 4]) : 2056789,
                            str([3, 1, 4]) : 2025770,
                            str([0, 2, 3]) : 1362644,
                            str([0, 1, 4]) : 1458740,
                            str([4, 2, 4]) : 1944548,
                            str([4, 0, 4]) : 1415084,
                            str([4, 2, 2]) : 1969437,
                            str([3, 2, 0]) : 1381532,
                            str([4, 1, 2]) : 2027094,
                            str([4, 4, 0]) : 1425654,
                            str([3, 4, 1]) : 1992295,
                            str([3, 0, 0]) : 46956489,
                            str([4, 0, 0]) : 46197156,
                            str([4, 0, 3]) : 1435445,
                            str([1, 2, 2]) : 2046667,
                            str([0, 2, 4]) : 1506503,
                            str([0, 0, 2]) : 46652592,
                            str([0, 0, 3]) : 47061511,
                            str([2, 1, 3]) : 1953314,
                            str([1, 4, 2]) : 2011095,
                            str([1, 1, 2]) : 2005843,
                            str([3, 2, 3]) : 2056738,
                            str([1, 3, 3]) : 1941133,
                            str([1, 0, 1]) : 1327937,
                            str([0, 4, 1]) : 1375266,
                            str([2, 4, 2]) : 2100042,
                            str([0, 3, 0]) : 1026501,
                            str([1, 2, 0]) : 1326849,
                            str([0, 1, 2]) : 1639310,
                            str([2, 3, 2]) : 2169602,
                            str([3, 4, 4]) : 2042768,
                            str([2, 0, 2]) : 1442658,
                            str([0, 2, 1]) : 1554741,
                            str([0, 0, 4]) : 46770087,
                            str([0, 1, 0]) : 951974,
                            str([1, 4, 4]) : 1887185,
                            str([4, 4, 2]) : 2211009,
                            str([3, 2, 2]) : 2073958,
                            str([4, 0, 2]) : 1448306,
                            str([1, 0, 0]) : 46156531,
                            str([1, 3, 0]) : 1544465,
                            str([2, 4, 3]) : 2264771,
                            str([4, 1, 3]) : 2109584,
                            str([0, 1, 3]) : 1473550,
                            str([2, 0, 3]) : 1438391,
                            str([4, 3, 4]) : 2107362,
                            str([1, 1, 0]) : 1385172,
                            str([0, 2, 2]) : 1583251}


    approx_bin_counts = [1444083, 1621926, 1300373, 1535362, 1941142, 1425314, 1591611, 1596419, 2065002, 1528113, 2070507, 1484093, 46506524, 2150366, 1296793, 1309006, 2157879, 1587777, 2106693, 1089164, 2179763, 1608772, 2020564, 2165269, 1051091, 2032193, 1365218, 1986140, 1392968, 2188500, 1380350, 1906070, 2020116, 1878683, 1938775, 1455954, 1960967, 2038542, 2204688, 1967662, 1419018, 1542981, 1882888, 1376941, 2225301, 2036434, 495085846, 2117636, 1582273, 2044550, 1889429, 1599550, 1416015, 1538185, 1564376, 2063849, 2124701, 2062045, 1428937, 2209754, 1455068, 2159079, 46427379, 2004519, 1948210, 2030972, 2156233, 2020535, 2146076, 2067761, 1442068, 2115993, 2065860, 1555202, 1821694, 2005275, 2256482, 2054532, 2029510, 1364768, 1458666, 1944616, 1416319, 1973694, 1381039, 2024228, 1424930, 1996680, 46957023, 46202247, 1433409, 2048036, 1508283, 46642419, 47067798, 1956684, 2012269, 2007067, 2055027, 1941780, 1325972, 1377722, 2096893, 1026385, 1328565, 1639012, 2168561, 2043865, 1441335, 1555587, 46774226, 951529, 1888078, 2208224, 2078587, 1451743, 46149589, 1538313, 2264863, 2111006, 1474617, 1437255, 2105775, 1384210, 1579341]
    exact_bin_counts = [bin_count_dict_exact[key] for key in bin_count_dict_exact]

    print
    print sum(exact_bin_counts)
    print sum(approx_bin_counts)

    """
    figure(0)
    hist(np.log10(exact_bin_counts), bins=50)
    xlabel(r'$\log_{10}$(count)', fontsize=24)
    ylabel('Number', fontsize=24)

    figure(1)
    hist(np.log10(approx_bin_counts), bins=50)
    xlabel(r'$\log_{10}$(count)', fontsize=24)
    ylabel('Number', fontsize=24)
    """
    
    figure(2)
    line1, = semilogy(exact_bin_counts, '-', color='k')
    line2, = semilogy(approx_bin_counts, '-', color='r')
    setp(line1, linestyle='--', linewidth=1)
    setp(line2, linestyle='--', linewidth=1)
    xlabel('Bin ID', fontsize=24)
    ylabel('Number of Particles', fontsize=24)
    axes = gca()
    axes.set_xlim(0, 125)

def other():

    Xs = [10, 50, 100, 150, 200, 250, 300, 350]

    #Ys_three = [22.725, 21.720, 9.541, 7.955, 5.480, 4.555]
    #Ys_four = [105.753, 43.875, 50.182, 20.6717, 13.127, 19.570]
    #Ys_five = [177.191, 72.414, 74.666, 34.402, 43.116, 44.760]

    Ys_three = [23.923, 21.474, 9.460, 7.604, 5.515, 4.534, 3.177, 3.418]
    Ys_four = [105.753, 43.159, 49.799, 20.564, 13.465, 18.893, 23.786, 23.6769]
    Ys_five = [177.191, 69.875, 75.022, 33.672, 42.032, 42.330, 38.732, 39.712]
    
    figure(3)
    plot(Xs, Ys_three, '-')
    xlabel('Number of Training Instances', fontsize=24)
    ylabel('Avg. L2 Test Error', fontsize=24)
    axes = gca()
    axes.set_ylim(0, 180)
    
    figure(4)
    plot(Xs, Ys_four, '-')
    xlabel('Number of Training Instances', fontsize=24)
    ylabel('Avg. L2 Test Error', fontsize=24)
    axes = gca()
    axes.set_ylim(0, 180)
    
    figure(5)
    plot(Xs, Ys_five, '-')
    xlabel('Number of Training Instances', fontsize=24)
    ylabel('Avg. L2 Test Error', fontsize=24)
    axes = gca()
    axes.set_ylim(0, 180)
    
    show()

    Ts = [1, 2, 3, 4, 5, 6, 7, 8, 9]
    Js = [-2.000, -13.766, -25.881, -34.206, -39.234, -42.042, -43.536, -44.332, -44.773]

    figure(0)
    plot(Ts, Js, '-')
    xlabel('T', fontsize=24)
    ylabel('J', fontsize=24)
    show()
    
    KNN_regress_times = [0.0499, 0.2800, 0.5600, 0.7500, 1.0600, 1.2400, 1.4400, 1.6800, 1.9199, 2.1499, 2.3900, 2.8799, 2.8100, 3.2800, 3.4700, 3.5000, 3.7199, 4.2500, 4.2299]
    full_regress_times = [1.7199, 2.0000, 2.4200, 2.5100, 2.8599, 3.2500, 3.3299, 3.5699, 3.8700, 4.1299, 4.3699, 4.7000, 4.8500, 5.5899, 5.6699, 5.7899, 5.9200, 6.6400, 6.6900]

    KNN_regress_times = [0.010000000000000009, 0.040000000000000036, 0.08000000000000007, 0.14000000000000057, 0.2099999999999973, 0.30000000000000426, 0.3999999999999986, 0.5300000000000011, 0.6700000000000017, 0.8299999999999983]
    full_regress_times = [0.47, 0.6399999999999997, 0.9199999999999999, 1.33, 1.8399999999999999, 2.519999999999996, 3.260000000000005, 4.109999999999999, 5.090000000000003, 6.230000000000004]
    
    Ts = range(1, 11)

    figure(0)
    plot(Ts, KNN_regress_times)
    plot(Ts, full_regress_times)
    xlabel('T', fontsize=24)
    ylabel('Regression Time (s)', fontsize=24)
    
    show()

    xs = range(2, 10)
    ys = [.16, .16, .20, .20, .20, .21, .21, .24]

    #figure(1)
    #plot(xs, ys, '-')
    #xlabel('Number of Processes', fontsize=24)
    #ylabel('Time to fit Coefficients (s)', fontsize=24)

    ovr = 60 + 41.6
    seq = 3*60 + 9.1
    nmp = [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
    pll = [60*2 + 23.5, 60*2 + 10.4, 60*2 + 3.0, 60*1 + 56.9, 60*1 + 56.7, 60*1 + 54.0, 60*1 + 52.6, 60*1 + 53.1, 60*1 + 52.5, 60*1 + 48.7, 60*1 + 48.4, 60*1 + 49.8, 60*1 + 44.4, 60*1 + 46.9, 60*1 + 47.1, 60*1 + 48.2, 60*1 + 47.7, 60*1 + 46.7, 60*1 + 46.0] #on 1000 samples

    #nmp += [30, 40, 50]
    #pll += [60 + 44, 60 + 45, 60 + 45]

    seq = seq - ovr
    pll = [p - ovr for p in pll]
    
    figure(2)
    plot(nmp, pll, '-')
    axhline(y = seq)
    xlabel('Number of Processes', fontsize=24)
    ylabel('Time to fit Coefficients (s)', fontsize=24)
     
    sizes = [100, 500, 1000, 1500, 2000, 2500] #, 5000, 7500, 10000]
    ovr = [5.1, 35.2, 60*1 + 41.6, 3*60 + 13.4, 60*5 + 16.8, 60*7 + 31.3] #overhead to create data
    seq = [6.0, 58.3, 60*3 + 8.4, 6*60 + 31.4, 60*11 + 8.5, 60*17 + 8.6]
    pll = [5.3, 37.9, 60 + 47.5, 3*60 + 33.5, 60*5 + 42.7, 60*8 + 13.4] # with 20 processes
     
    seq = [seq[i] - ovr[i] for i in range(len(seq))]
    pll = [pll[i] - ovr[i] for i in range(len(pll))]
    rats = [seq[i]/pll[i] for i in range(len(pll))]

    figure(3)
    plot(sizes[:len(seq)], seq, '-')
    plot(sizes[:len(pll)], pll, '-')
    xlabel('Number of Training Samples', fontsize=24)
    ylabel('Time to fit Coefficients (s)', fontsize=24)

    figure(4)
    plot(sizes[:len(rats)], rats, '-')
    xlabel('Number of Training Samples', fontsize=24)
    ylabel('Speedup Ratio (s)', fontsize=24)
     
    show()

"""
Create desired plots here.
"""
if __name__ == '__main__':

    assignment_speed()
    #bin_densities(0, 1)
    show()
